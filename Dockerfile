FROM ansibleplaybookbundle/apb-base:galaxy

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IHZpcnR1YWxpemF0aW9uCmRlc2NyaXB0aW9uOiBLdWJlVmlydCBp\
bnN0YWxsZXIKYmluZGFibGU6IEZhbHNlCmFzeW5jOiBvcHRpb25hbAptZXRhZGF0YToKICBkaXNw\
bGF5TmFtZTogVmlydHVhbGl6YXRpb24KICBsb25nRGVzY3JpcHRpb246IHwKICAgICBLdWJlVmly\
dCBlbmFibGVzIHRoZSBtaWdyYXRpb24gb2YgZXhpc3RpbmcgdmlydHVhbGl6ZWQgd29ya2xvYWRz\
IGRpcmVjdGx5IGludG8gdGhlIGRldmVsb3BtZW50IHdvcmtmbG93cyBzdXBwb3J0ZWQgYnkgS3Vi\
ZXJuZXRlcy4KCiAgICAgVGhpcyBwcm92aWRlcyBhIHBhdGggdG8gbW9yZSByYXBpZCBhcHBsaWNh\
dGlvbiBtb2Rlcm5pemF0aW9uIGJ5OgogICAgICAgICAtIFN1cHBvcnRpbmcgZGV2ZWxvcG1lbnQg\
b2YgbmV3IG1pY3Jvc2VydmljZSBhcHBsaWNhdGlvbnMgaW4gY29udGFpbmVycyB0aGF0IGludGVy\
YWN0IHdpdGggZXhpc3RpbmcgdmlydHVhbGl6ZWQgYXBwbGljYXRpb25zLgogICAgICAgICAtIENv\
bWJpbmluZyBleGlzdGluZyB2aXJ0dWFsaXplZCB3b3JrbG9hZHMgd2l0aCBuZXcgY29udGFpbmVy\
IHdvcmtsb2FkcyBvbiB0aGUgc2FtZSBwbGF0Zm9ybSwgdGhlcmVieSBtYWtpbmcgaXQgZWFzaWVy\
IHRvIGRlY29tcG9zZSBtb25vbGl0aGljIHZpcnR1YWxpemVkIHdvcmtsb2FkcyBpbnRvIGNvbnRh\
aW5lcnMgb3ZlciB0aW1lLgogIGRvY3VtZW50YXRpb25Vcmw6IGh0dHBzOi8vZ2l0aHViLmNvbS9r\
dWJldmlydC9rdWJldmlydC9ibG9iL21hc3Rlci9SRUFETUUubWQKICBpbWFnZVVybDogaHR0cHM6\
Ly9jZG4ucGJyZC5jby9pbWFnZXMvSDVHdXRkNy5wbmcKICBwcm92aWRlckRpc3BsYXlOYW1lOiAi\
UmVkIEhhdCwgSW5jLiIKcGxhbnM6CiAgLSBuYW1lOiBkZWZhdWx0CiAgICBkZXNjcmlwdGlvbjog\
RGVmYXVsdCBkZXBsb3ltZW50IHBsYW4gZm9yIGt1YmV2aXJ0LWFwYiB3aXRoIG5vIHN0b3JhZ2UK\
ICAgIG1ldGFkYXRhOgogICAgICBkaXNwbGF5TmFtZTogRGVmYXVsdAogICAgICBsb25nRGVzY3Jp\
cHRpb246IFRoaXMgcGxhbiBwcm92aWRlcyBrdWJldmlydCB3aXRoIG5vIHN0b3JhZ2UKICAgIGZy\
ZWU6IFRydWUKICAgIHBhcmFtZXRlcnM6CiAgICAgIC0gdGl0bGU6IE9wZW5TaGlmdCBBZG1pbiBV\
c2VyCiAgICAgICAgbmFtZTogYWRtaW5fdXNlcgogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAg\
IHJlcXVpcmVkOiB0cnVlCiAgICAgIC0gdGl0bGU6IE9wZW5TaGlmdCBBZG1pbiBQYXNzd29yZAog\
ICAgICAgIG5hbWU6IGFkbWluX3Bhc3N3b3JkCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAg\
cmVxdWlyZWQ6IHRydWUKICAgICAgICBkaXNwbGF5X3R5cGU6IHBhc3N3b3JkCiAgICAgIC0gbmFt\
ZTogdmVyc2lvbgogICAgICAgIHRpdGxlOiBWZXJzaW9uCiAgICAgICAgZGVmYXVsdDogdjAuNC4w\
LWFscGhhLjIKICAgICAgICBlbnVtOiBbJ3YwLjQuMC1hbHBoYS4yJywgJ3YwLjQuMC1hbHBoYS4x\
JywgJ3YwLjQuMC1hbHBoYS4wJywgJ3YwLjMuMCcsICd2MC4yLjAnLCAndjAuMS4wJ10KICAgICAg\
ICB0eXBlOiBlbnVtCiAgICAgIC0gbmFtZTogc3RvcmFnZV9yb2xlCiAgICAgICAgdGl0bGU6IEJh\
Y2tlbmQgU3RvcmFnZQogICAgICAgIGRlZmF1bHQ6IHN0b3JhZ2Utbm9uZQogICAgICAgIGVudW06\
IFsnc3RvcmFnZS1ub25lJ10KICAgICAgICB0eXBlOiBlbnVtCiAgLSBuYW1lOiBjbnMKICAgIGRl\
c2NyaXB0aW9uOiBEZXBsb3ltZW50IHBsYW4gd2l0aCBDTlMKICAgIG1ldGFkYXRhOgogICAgICBk\
aXNwbGF5TmFtZTogS3ViZVZpcnQgd2l0aCBDTlMgU3RvcmFnZQogICAgICBsb25nRGVzY3JpcHRp\
b246IFRoaXMgcGxhbiBwcm92aWRlcyBrdWJldmlydCB3aXRoIENOUyBzdG9yYWdlCiAgICBmcmVl\
OiBUcnVlCiAgICBwYXJhbWV0ZXJzOgogICAgICAtIHRpdGxlOiBPcGVuU2hpZnQgQWRtaW4gVXNl\
cgogICAgICAgIG5hbWU6IGFkbWluX3VzZXIKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICBy\
ZXF1aXJlZDogdHJ1ZQogICAgICAtIHRpdGxlOiBPcGVuU2hpZnQgQWRtaW4gUGFzc3dvcmQKICAg\
ICAgICBuYW1lOiBhZG1pbl9wYXNzd29yZAogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIHJl\
cXVpcmVkOiB0cnVlCiAgICAgICAgZGlzcGxheV90eXBlOiBwYXNzd29yZAogICAgICAtIG5hbWU6\
IHZlcnNpb24KICAgICAgICB0aXRsZTogVmVyc2lvbgogICAgICAgIGRlZmF1bHQ6IHYwLjQuMC1h\
bHBoYS4yCiAgICAgICAgZW51bTogWyd2MC40LjAtYWxwaGEuMicsICd2MC40LjAtYWxwaGEuMScs\
ICd2MC40LjAtYWxwaGEuMCcsICd2MC4zLjAnLCAndjAuMi4wJywgJ3YwLjEuMCddCiAgICAgICAg\
dHlwZTogZW51bQogICAgICAtIG5hbWU6IHN0b3JhZ2Vfcm9sZQogICAgICAgIHRpdGxlOiBCYWNr\
ZW5kIFN0b3JhZ2UKICAgICAgICBkZWZhdWx0OiBzdG9yYWdlLWNucwogICAgICAgIGVudW06IFsn\
c3RvcmFnZS1jbnMnXQogICAgICAgIHR5cGU6IGVudW0KICAtIG5hbWU6IHN0b3JhZ2UtZGVtbwog\
ICAgZGVzY3JpcHRpb246IERlcGxveW1lbnQgcGxhbiB3aXRoIGVwaGVtZXJhbCBzdG9yYWdlCiAg\
ICBtZXRhZGF0YToKICAgICAgZGlzcGxheU5hbWU6IEt1YmVWaXJ0IHdpdGggZXBoZW1lcmFsIFN0\
b3JhZ2UKICAgICAgbG9uZ0Rlc2NyaXB0aW9uOiBUaGlzIHBsYW4gcHJvdmlkZXMga3ViZXZpcnQg\
d2l0aCBlcGhlbWVyYWwgc3RvcmFnZQogICAgZnJlZTogVHJ1ZQogICAgcGFyYW1ldGVyczoKICAg\
ICAgLSB0aXRsZTogT3BlblNoaWZ0IEFkbWluIFVzZXIKICAgICAgICBuYW1lOiBhZG1pbl91c2Vy\
CiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgLSB0aXRs\
ZTogT3BlblNoaWZ0IEFkbWluIFBhc3N3b3JkCiAgICAgICAgbmFtZTogYWRtaW5fcGFzc3dvcmQK\
ICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAgIGRpc3Bs\
YXlfdHlwZTogcGFzc3dvcmQKICAgICAgLSBuYW1lOiB2ZXJzaW9uCiAgICAgICAgdGl0bGU6IFZl\
cnNpb24KICAgICAgICBkZWZhdWx0OiB2MC40LjAtYWxwaGEuMgogICAgICAgIGVudW06IFsndjAu\
NC4wLWFscGhhLjInLCAndjAuNC4wLWFscGhhLjEnLCAndjAuNC4wLWFscGhhLjAnLCAndjAuMy4w\
JywgJ3YwLjIuMCcsICd2MC4xLjAnXQogICAgICAgIHR5cGU6IGVudW0KICAgICAgLSBuYW1lOiBz\
dG9yYWdlX3JvbGUKICAgICAgICB0aXRsZTogQmFja2VuZCBTdG9yYWdlCiAgICAgICAgZGVmYXVs\
dDogc3RvcmFnZS1kZW1vCiAgICAgICAgZW51bTogWydzdG9yYWdlLWRlbW8nXQogICAgICAgIHR5\
cGU6IGVudW0KICAtIG5hbWU6IGNpbmRlcgogICAgZGVzY3JpcHRpb246IERlcGxveW1lbnQgcGxh\
biBmb3Iga3ViZXZpcnQtYXBiIHdpdGggQ2luZGVyIGJhY2tlbmQKICAgIG1ldGFkYXRhOgogICAg\
ICBkaXNwbGF5TmFtZTogS3ViZVZpcnQgd2l0aCBDaW5kZXIgYmFja2VuZAogICAgICBsb25nRGVz\
Y3JpcHRpb246IFRoaXMgcGxhbiBwcm92aWRlcyBrdWJldmlydCB3aXRoIENpbmRlciBiYWNrZW5k\
CiAgICBmcmVlOiBUcnVlCiAgICBwYXJhbWV0ZXJzOgogICAgICAtIHRpdGxlOiBPcGVuU2hpZnQg\
QWRtaW4gVXNlcgogICAgICAgIG5hbWU6IGFkbWluX3VzZXIKICAgICAgICB0eXBlOiBzdHJpbmcK\
ICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAtIHRpdGxlOiBPcGVuU2hpZnQgQWRtaW4gUGFz\
c3dvcmQKICAgICAgICBuYW1lOiBhZG1pbl9wYXNzd29yZAogICAgICAgIHR5cGU6IHN0cmluZwog\
ICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgICAgZGlzcGxheV90eXBlOiBwYXNzd29yZAogICAg\
ICAtIG5hbWU6IHZlcnNpb24KICAgICAgICB0aXRsZTogVmVyc2lvbgogICAgICAgIGRlZmF1bHQ6\
IHYwLjQuMC1hbHBoYS4yCiAgICAgICAgZW51bTogWyd2MC40LjAtYWxwaGEuMicsICd2MC40LjAt\
YWxwaGEuMScsICd2MC40LjAtYWxwaGEuMCcsICd2MC4zLjAnLCAndjAuMi4wJywgJ3YwLjEuMCdd\
CiAgICAgICAgdHlwZTogZW51bQogICAgICAtIG5hbWU6IHN0b3JhZ2Vfcm9sZQogICAgICAgIHRp\
dGxlOiBCYWNrZW5kIFN0b3JhZ2UKICAgICAgICBkZWZhdWx0OiBjaW5kZXIKICAgICAgICBlbnVt\
OiBbJ2NpbmRlciddCiAgICAgICAgdHlwZTogZW51bQo="



ENV APB_ACTION_PATH="kubevirt-ansible/playbooks/kubevirt.yml"
COPY requirements.yml /opt/ansible/requirements.yml

RUN ansible-galaxy install -r /opt/ansible/requirements.yml
RUN chmod -R g=u /opt/{ansible,apb} /etc/ansible/roles

USER apb
