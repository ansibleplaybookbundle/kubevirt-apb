FROM ansibleplaybookbundle/apb-base:galaxy

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IHZpcnR1YWxpemF0aW9uCmRlc2NyaXB0aW9uOiBLdWJlVmlydCBp\
bnN0YWxsZXIKYmluZGFibGU6IEZhbHNlCmFzeW5jOiBvcHRpb25hbAp0YWdzOgogIC0gdmlydHVh\
bG1hY2hpbmUKbWV0YWRhdGE6CiAgZGlzcGxheU5hbWU6IFZpcnR1YWxpemF0aW9uCiAgbG9uZ0Rl\
c2NyaXB0aW9uOiB8CiAgICAgS3ViZVZpcnQgZW5hYmxlcyB0aGUgbWlncmF0aW9uIG9mIGV4aXN0\
aW5nIHZpcnR1YWxpemVkIHdvcmtsb2FkcyBkaXJlY3RseSBpbnRvIHRoZSBkZXZlbG9wbWVudCB3\
b3JrZmxvd3Mgc3VwcG9ydGVkIGJ5IEt1YmVybmV0ZXMuCgogICAgIFRoaXMgcHJvdmlkZXMgYSBw\
YXRoIHRvIG1vcmUgcmFwaWQgYXBwbGljYXRpb24gbW9kZXJuaXphdGlvbiBieToKICAgICAgICAg\
LSBTdXBwb3J0aW5nIGRldmVsb3BtZW50IG9mIG5ldyBtaWNyb3NlcnZpY2UgYXBwbGljYXRpb25z\
IGluIGNvbnRhaW5lcnMgdGhhdCBpbnRlcmFjdCB3aXRoIGV4aXN0aW5nIHZpcnR1YWxpemVkIGFw\
cGxpY2F0aW9ucy4KICAgICAgICAgLSBDb21iaW5pbmcgZXhpc3RpbmcgdmlydHVhbGl6ZWQgd29y\
a2xvYWRzIHdpdGggbmV3IGNvbnRhaW5lciB3b3JrbG9hZHMgb24gdGhlIHNhbWUgcGxhdGZvcm0s\
IHRoZXJlYnkgbWFraW5nIGl0IGVhc2llciB0byBkZWNvbXBvc2UgbW9ub2xpdGhpYyB2aXJ0dWFs\
aXplZCB3b3JrbG9hZHMgaW50byBjb250YWluZXJzIG92ZXIgdGltZS4KICBkb2N1bWVudGF0aW9u\
VXJsOiBodHRwczovL2dpdGh1Yi5jb20va3ViZXZpcnQva3ViZXZpcnQvYmxvYi9tYXN0ZXIvUkVB\
RE1FLm1kCiAgaW1hZ2VVcmw6IGh0dHBzOi8vY2RuLnBicmQuY28vaW1hZ2VzL0g1R3V0ZDcucG5n\
CiAgcHJvdmlkZXJEaXNwbGF5TmFtZTogIlJlZCBIYXQsIEluYy4iCnBsYW5zOgogIC0gbmFtZTog\
ZGVmYXVsdAogICAgZGVzY3JpcHRpb246IERlZmF1bHQgZGVwbG95bWVudCBwbGFuIGZvciBrdWJl\
dmlydC1hcGIgd2l0aCBubyBzdG9yYWdlCiAgICBtZXRhZGF0YToKICAgICAgZGlzcGxheU5hbWU6\
IERlZmF1bHQKICAgICAgbG9uZ0Rlc2NyaXB0aW9uOiBUaGlzIHBsYW4gcHJvdmlkZXMga3ViZXZp\
cnQgd2l0aCBubyBzdG9yYWdlCiAgICBmcmVlOiBUcnVlCiAgICBwYXJhbWV0ZXJzOgogICAgICAt\
IHRpdGxlOiBPcGVuU2hpZnQgQWRtaW4gVXNlcgogICAgICAgIG5hbWU6IGFkbWluX3VzZXIKICAg\
ICAgICB0eXBlOiBzdHJpbmcKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAtIHRpdGxlOiBP\
cGVuU2hpZnQgQWRtaW4gUGFzc3dvcmQKICAgICAgICBuYW1lOiBhZG1pbl9wYXNzd29yZAogICAg\
ICAgIHR5cGU6IHN0cmluZwogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgICAgZGlzcGxheV90\
eXBlOiBwYXNzd29yZAogICAgICAtIG5hbWU6IHZlcnNpb24KICAgICAgICB0aXRsZTogVmVyc2lv\
bgogICAgICAgIGRlZmF1bHQ6IHYwLjQuMC1hbHBoYS4yCiAgICAgICAgZW51bTogWyd2MC40LjAt\
YWxwaGEuMicsICd2MC40LjAtYWxwaGEuMScsICd2MC40LjAtYWxwaGEuMCcsICd2MC4zLjAnLCAn\
djAuMi4wJywgJ3YwLjEuMCddCiAgICAgICAgdHlwZTogZW51bQogICAgICAtIG5hbWU6IHN0b3Jh\
Z2Vfcm9sZQogICAgICAgIHRpdGxlOiBCYWNrZW5kIFN0b3JhZ2UKICAgICAgICBkZWZhdWx0OiBz\
dG9yYWdlLW5vbmUKICAgICAgICBlbnVtOiBbJ3N0b3JhZ2Utbm9uZSddCiAgICAgICAgdHlwZTog\
ZW51bQogIC0gbmFtZTogZ2x1c3RlcgogICAgZGVzY3JpcHRpb246IERlcGxveW1lbnQgcGxhbiB3\
aXRoIEdsdXN0ZXIgc3RvcmFnZQogICAgbWV0YWRhdGE6CiAgICAgIGRpc3BsYXlOYW1lOiBLdWJl\
VmlydCB3aXRoIEdsdXN0ZXIgU3RvcmFnZQogICAgICBsb25nRGVzY3JpcHRpb246IFRoaXMgcGxh\
biBwcm92aWRlcyBrdWJldmlydCB3aXRoIEdsdXN0ZXIgc3RvcmFnZQogICAgZnJlZTogVHJ1ZQog\
ICAgcGFyYW1ldGVyczoKICAgICAgLSB0aXRsZTogT3BlblNoaWZ0IEFkbWluIFVzZXIKICAgICAg\
ICBuYW1lOiBhZG1pbl91c2VyCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgcmVxdWlyZWQ6\
IHRydWUKICAgICAgLSB0aXRsZTogT3BlblNoaWZ0IEFkbWluIFBhc3N3b3JkCiAgICAgICAgbmFt\
ZTogYWRtaW5fcGFzc3dvcmQKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICByZXF1aXJlZDog\
dHJ1ZQogICAgICAgIGRpc3BsYXlfdHlwZTogcGFzc3dvcmQKICAgICAgLSBuYW1lOiB2ZXJzaW9u\
CiAgICAgICAgdGl0bGU6IFZlcnNpb24KICAgICAgICBkZWZhdWx0OiB2MC40LjAtYWxwaGEuMgog\
ICAgICAgIGVudW06IFsndjAuNC4wLWFscGhhLjInLCAndjAuNC4wLWFscGhhLjEnLCAndjAuNC4w\
LWFscGhhLjAnLCAndjAuMy4wJywgJ3YwLjIuMCcsICd2MC4xLjAnXQogICAgICAgIHR5cGU6IGVu\
dW0KICAgICAgLSBuYW1lOiBzdG9yYWdlX3JvbGUKICAgICAgICB0aXRsZTogQmFja2VuZCBTdG9y\
YWdlCiAgICAgICAgZGVmYXVsdDogc3RvcmFnZS1nbHVzdGVyZnMKICAgICAgICBlbnVtOiBbJ3N0\
b3JhZ2UtZ2x1c3RlcmZzJ10KICAgICAgICB0eXBlOiBlbnVtCiAgLSBuYW1lOiBzdG9yYWdlLWRl\
bW8KICAgIGRlc2NyaXB0aW9uOiBEZXBsb3ltZW50IHBsYW4gd2l0aCBlcGhlbWVyYWwgc3RvcmFn\
ZQogICAgbWV0YWRhdGE6CiAgICAgIGRpc3BsYXlOYW1lOiBLdWJlVmlydCB3aXRoIGVwaGVtZXJh\
bCBTdG9yYWdlCiAgICAgIGxvbmdEZXNjcmlwdGlvbjogVGhpcyBwbGFuIHByb3ZpZGVzIGt1YmV2\
aXJ0IHdpdGggZXBoZW1lcmFsIHN0b3JhZ2UKICAgIGZyZWU6IFRydWUKICAgIHBhcmFtZXRlcnM6\
CiAgICAgIC0gdGl0bGU6IE9wZW5TaGlmdCBBZG1pbiBVc2VyCiAgICAgICAgbmFtZTogYWRtaW5f\
dXNlcgogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgIC0g\
dGl0bGU6IE9wZW5TaGlmdCBBZG1pbiBQYXNzd29yZAogICAgICAgIG5hbWU6IGFkbWluX3Bhc3N3\
b3JkCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgICBk\
aXNwbGF5X3R5cGU6IHBhc3N3b3JkCiAgICAgIC0gbmFtZTogdmVyc2lvbgogICAgICAgIHRpdGxl\
OiBWZXJzaW9uCiAgICAgICAgZGVmYXVsdDogdjAuNC4wLWFscGhhLjIKICAgICAgICBlbnVtOiBb\
J3YwLjQuMC1hbHBoYS4yJywgJ3YwLjQuMC1hbHBoYS4xJywgJ3YwLjQuMC1hbHBoYS4wJywgJ3Yw\
LjMuMCcsICd2MC4yLjAnLCAndjAuMS4wJ10KICAgICAgICB0eXBlOiBlbnVtCiAgICAgIC0gbmFt\
ZTogc3RvcmFnZV9yb2xlCiAgICAgICAgdGl0bGU6IEJhY2tlbmQgU3RvcmFnZQogICAgICAgIGRl\
ZmF1bHQ6IHN0b3JhZ2UtZGVtbwogICAgICAgIGVudW06IFsnc3RvcmFnZS1kZW1vJ10KICAgICAg\
ICB0eXBlOiBlbnVtCiAgLSBuYW1lOiBjaW5kZXIKICAgIGRlc2NyaXB0aW9uOiBEZXBsb3ltZW50\
IHBsYW4gZm9yIGt1YmV2aXJ0LWFwYiB3aXRoIENpbmRlciBiYWNrZW5kCiAgICBtZXRhZGF0YToK\
ICAgICAgZGlzcGxheU5hbWU6IEt1YmVWaXJ0IHdpdGggQ2luZGVyIGJhY2tlbmQKICAgICAgbG9u\
Z0Rlc2NyaXB0aW9uOiBUaGlzIHBsYW4gcHJvdmlkZXMga3ViZXZpcnQgd2l0aCBDaW5kZXIgYmFj\
a2VuZAogICAgZnJlZTogVHJ1ZQogICAgcGFyYW1ldGVyczoKICAgICAgLSB0aXRsZTogT3BlblNo\
aWZ0IEFkbWluIFVzZXIKICAgICAgICBuYW1lOiBhZG1pbl91c2VyCiAgICAgICAgdHlwZTogc3Ry\
aW5nCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgLSB0aXRsZTogT3BlblNoaWZ0IEFkbWlu\
IFBhc3N3b3JkCiAgICAgICAgbmFtZTogYWRtaW5fcGFzc3dvcmQKICAgICAgICB0eXBlOiBzdHJp\
bmcKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAgIGRpc3BsYXlfdHlwZTogcGFzc3dvcmQK\
ICAgICAgLSBuYW1lOiB2ZXJzaW9uCiAgICAgICAgdGl0bGU6IFZlcnNpb24KICAgICAgICBkZWZh\
dWx0OiB2MC40LjAtYWxwaGEuMgogICAgICAgIGVudW06IFsndjAuNC4wLWFscGhhLjInLCAndjAu\
NC4wLWFscGhhLjEnLCAndjAuNC4wLWFscGhhLjAnLCAndjAuMy4wJywgJ3YwLjIuMCcsICd2MC4x\
LjAnXQogICAgICAgIHR5cGU6IGVudW0KICAgICAgLSBuYW1lOiBzdG9yYWdlX3JvbGUKICAgICAg\
ICB0aXRsZTogQmFja2VuZCBTdG9yYWdlCiAgICAgICAgZGVmYXVsdDogY2luZGVyCiAgICAgICAg\
ZW51bTogWydjaW5kZXInXQogICAgICAgIHR5cGU6IGVudW0K"


ENV APB_ACTION_PATH="kubevirt-ansible/playbooks/kubevirt.yml"
COPY requirements.yml /opt/ansible/requirements.yml

RUN ansible-galaxy install -r /opt/ansible/requirements.yml
RUN chmod -R g=u /opt/{ansible,apb} /etc/ansible/roles

USER apb
