FROM ansibleplaybookbundle/apb-base:galaxy

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IHZpcnR1YWxpemF0aW9uCmRlc2NyaXB0aW9uOiBLdWJlVmlydCBp\
bnN0YWxsZXIKYmluZGFibGU6IEZhbHNlCmFzeW5jOiBvcHRpb25hbAp0YWdzOgogIC0gdmlydHVh\
bG1hY2hpbmUKbWV0YWRhdGE6CiAgZGlzcGxheU5hbWU6IEt1YmV2aXJ0CiAgbG9uZ0Rlc2NyaXB0\
aW9uOiB8CiAgICAgS3ViZVZpcnQgZW5hYmxlcyB0aGUgbWlncmF0aW9uIG9mIGV4aXN0aW5nIHZp\
cnR1YWxpemVkIHdvcmtsb2FkcyBkaXJlY3RseSBpbnRvIHRoZSBkZXZlbG9wbWVudCB3b3JrZmxv\
d3Mgc3VwcG9ydGVkIGJ5IEt1YmVybmV0ZXMuCgogICAgIFRoaXMgcHJvdmlkZXMgYSBwYXRoIHRv\
IG1vcmUgcmFwaWQgYXBwbGljYXRpb24gbW9kZXJuaXphdGlvbiBieToKICAgICAgICAgLSBTdXBw\
b3J0aW5nIGRldmVsb3BtZW50IG9mIG5ldyBtaWNyb3NlcnZpY2UgYXBwbGljYXRpb25zIGluIGNv\
bnRhaW5lcnMgdGhhdCBpbnRlcmFjdCB3aXRoIGV4aXN0aW5nIHZpcnR1YWxpemVkIGFwcGxpY2F0\
aW9ucy4KICAgICAgICAgLSBDb21iaW5pbmcgZXhpc3RpbmcgdmlydHVhbGl6ZWQgd29ya2xvYWRz\
IHdpdGggbmV3IGNvbnRhaW5lciB3b3JrbG9hZHMgb24gdGhlIHNhbWUgcGxhdGZvcm0sIHRoZXJl\
YnkgbWFraW5nIGl0IGVhc2llciB0byBkZWNvbXBvc2UgbW9ub2xpdGhpYyB2aXJ0dWFsaXplZCB3\
b3JrbG9hZHMgaW50byBjb250YWluZXJzIG92ZXIgdGltZS4KICBkb2N1bWVudGF0aW9uVXJsOiBo\
dHRwczovL2dpdGh1Yi5jb20va3ViZXZpcnQva3ViZXZpcnQvYmxvYi9tYXN0ZXIvUkVBRE1FLm1k\
CiAgaW1hZ2VVcmw6IGh0dHBzOi8vY2RuLnBicmQuY28vaW1hZ2VzL0g1R3V0ZDcucG5nCiAgcHJv\
dmlkZXJEaXNwbGF5TmFtZTogIlJlZCBIYXQsIEluYy4iCnBsYW5zOgogIC0gbmFtZTogZGVmYXVs\
dAogICAgZGVzY3JpcHRpb246IERlZmF1bHQgZGVwbG95bWVudCBwbGFuIGZvciBrdWJldmlydC1h\
cGIgd2l0aCBubyBzdG9yYWdlCiAgICBtZXRhZGF0YToKICAgICAgZGlzcGxheU5hbWU6IERlZmF1\
bHQKICAgICAgbG9uZ0Rlc2NyaXB0aW9uOiBUaGlzIHBsYW4gcHJvdmlkZXMga3ViZXZpcnQgd2l0\
aCBubyBzdG9yYWdlCiAgICBmcmVlOiBUcnVlCiAgICBwYXJhbWV0ZXJzOgogICAgICAtIHRpdGxl\
OiBPcGVuU2hpZnQgQWRtaW4gVXNlcgogICAgICAgIG5hbWU6IGFkbWluX3VzZXIKICAgICAgICB0\
eXBlOiBzdHJpbmcKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAtIHRpdGxlOiBPcGVuU2hp\
ZnQgQWRtaW4gUGFzc3dvcmQKICAgICAgICBuYW1lOiBhZG1pbl9wYXNzd29yZAogICAgICAgIHR5\
cGU6IHN0cmluZwogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgICAgZGlzcGxheV90eXBlOiBw\
YXNzd29yZAogICAgICAtIG5hbWU6IHZlcnNpb24KICAgICAgICB0aXRsZTogVmVyc2lvbgogICAg\
ICAgIGRlZmF1bHQ6IDAuNC4xLWFscGhhLjEKICAgICAgICBlbnVtOiBbJzAuNC4xLWFscGhhLjEn\
LCAnMC40LjAnLCAnMC4zLjAnLCAnMC4yLjAnLCAnMC4xLjAnXQogICAgICAgIHR5cGU6IGVudW0K\
ICAgICAgLSBuYW1lOiBzdG9yYWdlX3JvbGUKICAgICAgICB0aXRsZTogQmFja2VuZCBTdG9yYWdl\
CiAgICAgICAgZGVmYXVsdDogc3RvcmFnZS1ub25lCiAgICAgICAgZW51bTogWydzdG9yYWdlLW5v\
bmUnXQogICAgICAgIHR5cGU6IGVudW0KICAtIG5hbWU6IGdsdXN0ZXIKICAgIGRlc2NyaXB0aW9u\
OiBEZXBsb3ltZW50IHBsYW4gd2l0aCBHbHVzdGVyIHN0b3JhZ2UKICAgIG1ldGFkYXRhOgogICAg\
ICBkaXNwbGF5TmFtZTogS3ViZVZpcnQgd2l0aCBHbHVzdGVyIFN0b3JhZ2UKICAgICAgbG9uZ0Rl\
c2NyaXB0aW9uOiBUaGlzIHBsYW4gcHJvdmlkZXMga3ViZXZpcnQgd2l0aCBHbHVzdGVyIHN0b3Jh\
Z2UKICAgIGZyZWU6IFRydWUKICAgIHBhcmFtZXRlcnM6CiAgICAgIC0gdGl0bGU6IE9wZW5TaGlm\
dCBBZG1pbiBVc2VyCiAgICAgICAgbmFtZTogYWRtaW5fdXNlcgogICAgICAgIHR5cGU6IHN0cmlu\
ZwogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgIC0gdGl0bGU6IE9wZW5TaGlmdCBBZG1pbiBQ\
YXNzd29yZAogICAgICAgIG5hbWU6IGFkbWluX3Bhc3N3b3JkCiAgICAgICAgdHlwZTogc3RyaW5n\
CiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgICBkaXNwbGF5X3R5cGU6IHBhc3N3b3JkCiAg\
ICAgIC0gbmFtZTogdmVyc2lvbgogICAgICAgIHRpdGxlOiBWZXJzaW9uCiAgICAgICAgZGVmYXVs\
dDogMC40LjEtYWxwaGEuMQogICAgICAgIGVudW06IFsnMC40LjEtYWxwaGEuMScsICcwLjQuMCcs\
ICcwLjMuMCcsICcwLjIuMCcsICcwLjEuMCddCiAgICAgICAgdHlwZTogZW51bQogICAgICAtIG5h\
bWU6IHN0b3JhZ2Vfcm9sZQogICAgICAgIHRpdGxlOiBCYWNrZW5kIFN0b3JhZ2UKICAgICAgICBk\
ZWZhdWx0OiBzdG9yYWdlLWdsdXN0ZXJmcwogICAgICAgIGVudW06IFsnc3RvcmFnZS1nbHVzdGVy\
ZnMnXQogICAgICAgIHR5cGU6IGVudW0KICAtIG5hbWU6IHN0b3JhZ2UtZGVtbwogICAgZGVzY3Jp\
cHRpb246IERlcGxveW1lbnQgcGxhbiB3aXRoIGVwaGVtZXJhbCBzdG9yYWdlCiAgICBtZXRhZGF0\
YToKICAgICAgZGlzcGxheU5hbWU6IEt1YmVWaXJ0IHdpdGggZXBoZW1lcmFsIFN0b3JhZ2UKICAg\
ICAgbG9uZ0Rlc2NyaXB0aW9uOiBUaGlzIHBsYW4gcHJvdmlkZXMga3ViZXZpcnQgd2l0aCBlcGhl\
bWVyYWwgc3RvcmFnZQogICAgZnJlZTogVHJ1ZQogICAgcGFyYW1ldGVyczoKICAgICAgLSB0aXRs\
ZTogT3BlblNoaWZ0IEFkbWluIFVzZXIKICAgICAgICBuYW1lOiBhZG1pbl91c2VyCiAgICAgICAg\
dHlwZTogc3RyaW5nCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgLSB0aXRsZTogT3BlblNo\
aWZ0IEFkbWluIFBhc3N3b3JkCiAgICAgICAgbmFtZTogYWRtaW5fcGFzc3dvcmQKICAgICAgICB0\
eXBlOiBzdHJpbmcKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAgIGRpc3BsYXlfdHlwZTog\
cGFzc3dvcmQKICAgICAgLSBuYW1lOiB2ZXJzaW9uCiAgICAgICAgdGl0bGU6IFZlcnNpb24KICAg\
ICAgICBkZWZhdWx0OiAwLjQuMS1hbHBoYS4xCiAgICAgICAgZW51bTogWycwLjQuMS1hbHBoYS4x\
JywgJzAuNC4wJywgJzAuMy4wJywgJzAuMi4wJywgJzAuMS4wJ10KICAgICAgICB0eXBlOiBlbnVt\
CiAgICAgIC0gbmFtZTogc3RvcmFnZV9yb2xlCiAgICAgICAgdGl0bGU6IEJhY2tlbmQgU3RvcmFn\
ZQogICAgICAgIGRlZmF1bHQ6IHN0b3JhZ2UtZGVtbwogICAgICAgIGVudW06IFsnc3RvcmFnZS1k\
ZW1vJ10KICAgICAgICB0eXBlOiBlbnVtCiAgLSBuYW1lOiBjaW5kZXIKICAgIGRlc2NyaXB0aW9u\
OiBEZXBsb3ltZW50IHBsYW4gZm9yIGt1YmV2aXJ0LWFwYiB3aXRoIENpbmRlciBiYWNrZW5kCiAg\
ICBtZXRhZGF0YToKICAgICAgZGlzcGxheU5hbWU6IEt1YmVWaXJ0IHdpdGggQ2luZGVyIGJhY2tl\
bmQKICAgICAgbG9uZ0Rlc2NyaXB0aW9uOiBUaGlzIHBsYW4gcHJvdmlkZXMga3ViZXZpcnQgd2l0\
aCBDaW5kZXIgYmFja2VuZAogICAgZnJlZTogVHJ1ZQogICAgcGFyYW1ldGVyczoKICAgICAgLSB0\
aXRsZTogT3BlblNoaWZ0IEFkbWluIFVzZXIKICAgICAgICBuYW1lOiBhZG1pbl91c2VyCiAgICAg\
ICAgdHlwZTogc3RyaW5nCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgLSB0aXRsZTogT3Bl\
blNoaWZ0IEFkbWluIFBhc3N3b3JkCiAgICAgICAgbmFtZTogYWRtaW5fcGFzc3dvcmQKICAgICAg\
ICB0eXBlOiBzdHJpbmcKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAgIGRpc3BsYXlfdHlw\
ZTogcGFzc3dvcmQKICAgICAgLSBuYW1lOiB2ZXJzaW9uCiAgICAgICAgdGl0bGU6IFZlcnNpb24K\
ICAgICAgICBkZWZhdWx0OiAwLjQuMS1hbHBoYS4xCiAgICAgICAgZW51bTogWycwLjQuMS1hbHBo\
YS4xJywgJzAuNC4wJywgJzAuMy4wJywgJzAuMi4wJywgJzAuMS4wJ10KICAgICAgICB0eXBlOiBl\
bnVtCiAgICAgIC0gbmFtZTogc3RvcmFnZV9yb2xlCiAgICAgICAgdGl0bGU6IEJhY2tlbmQgU3Rv\
cmFnZQogICAgICAgIGRlZmF1bHQ6IGNpbmRlcgogICAgICAgIGVudW06IFsnY2luZGVyJ10KICAg\
ICAgICB0eXBlOiBlbnVtCg=="



ENV APB_ACTION_PATH="kubevirt-ansible/playbooks/kubevirt.yml"
COPY requirements.yml /opt/ansible/requirements.yml

RUN ansible-galaxy install -r /opt/ansible/requirements.yml
RUN chmod -R g=u /opt/{ansible,apb} /etc/ansible/roles

USER apb
