FROM ansibleplaybookbundle/apb-base:galaxy

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IHZpcnR1YWxpemF0aW9uCmRlc2NyaXB0aW9uOiBLdWJlVmlydCBp\
bnN0YWxsZXIKYmluZGFibGU6IEZhbHNlCmFzeW5jOiBvcHRpb25hbAptZXRhZGF0YToKICBkaXNw\
bGF5TmFtZTogS3ViZXZpcnQKICBsb25nRGVzY3JpcHRpb246IHwKICAgICBLdWJlVmlydCBlbmFi\
bGVzIHRoZSBtaWdyYXRpb24gb2YgZXhpc3RpbmcgdmlydHVhbGl6ZWQgd29ya2xvYWRzIGRpcmVj\
dGx5IGludG8gdGhlIGRldmVsb3BtZW50IHdvcmtmbG93cyBzdXBwb3J0ZWQgYnkgS3ViZXJuZXRl\
cy4KCiAgICAgVGhpcyBwcm92aWRlcyBhIHBhdGggdG8gbW9yZSByYXBpZCBhcHBsaWNhdGlvbiBt\
b2Rlcm5pemF0aW9uIGJ5OgogICAgICAgICAtIFN1cHBvcnRpbmcgZGV2ZWxvcG1lbnQgb2YgbmV3\
IG1pY3Jvc2VydmljZSBhcHBsaWNhdGlvbnMgaW4gY29udGFpbmVycyB0aGF0IGludGVyYWN0IHdp\
dGggZXhpc3RpbmcgdmlydHVhbGl6ZWQgYXBwbGljYXRpb25zLgogICAgICAgICAtIENvbWJpbmlu\
ZyBleGlzdGluZyB2aXJ0dWFsaXplZCB3b3JrbG9hZHMgd2l0aCBuZXcgY29udGFpbmVyIHdvcmts\
b2FkcyBvbiB0aGUgc2FtZSBwbGF0Zm9ybSwgdGhlcmVieSBtYWtpbmcgaXQgZWFzaWVyIHRvIGRl\
Y29tcG9zZSBtb25vbGl0aGljIHZpcnR1YWxpemVkIHdvcmtsb2FkcyBpbnRvIGNvbnRhaW5lcnMg\
b3ZlciB0aW1lLgogIGRvY3VtZW50YXRpb25Vcmw6IGh0dHBzOi8vZ2l0aHViLmNvbS9rdWJldmly\
dC9rdWJldmlydC9ibG9iL21hc3Rlci9SRUFETUUubWQKICBpbWFnZVVybDogaHR0cHM6Ly9jZG4u\
cGJyZC5jby9pbWFnZXMvSDVHdXRkNy5wbmcKICBwcm92aWRlckRpc3BsYXlOYW1lOiAiUmVkIEhh\
dCwgSW5jLiIKcGxhbnM6CiAgLSBuYW1lOiBkZWZhdWx0CiAgICBkZXNjcmlwdGlvbjogRGVmYXVs\
dCBkZXBsb3ltZW50IHBsYW4gZm9yIGt1YmV2aXJ0LWFwYiB3aXRoIG5vIHN0b3JhZ2UKICAgIG1l\
dGFkYXRhOgogICAgICBkaXNwbGF5TmFtZTogRGVmYXVsdAogICAgICBsb25nRGVzY3JpcHRpb246\
IFRoaXMgcGxhbiBwcm92aWRlcyBrdWJldmlydCB3aXRoIG5vIHN0b3JhZ2UKICAgIGZyZWU6IFRy\
dWUKICAgIHBhcmFtZXRlcnM6CiAgICAgIC0gdGl0bGU6IE9wZW5TaGlmdCBBZG1pbiBVc2VyCiAg\
ICAgICAgbmFtZTogYWRtaW5fdXNlcgogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIHJlcXVp\
cmVkOiB0cnVlCiAgICAgIC0gdGl0bGU6IE9wZW5TaGlmdCBBZG1pbiBQYXNzd29yZAogICAgICAg\
IG5hbWU6IGFkbWluX3Bhc3N3b3JkCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgcmVxdWly\
ZWQ6IHRydWUKICAgICAgICBkaXNwbGF5X3R5cGU6IHBhc3N3b3JkCiAgICAgIC0gbmFtZTogdmVy\
c2lvbgogICAgICAgIHRpdGxlOiBWZXJzaW9uCiAgICAgICAgZGVmYXVsdDogMC40LjEtYWxwaGEu\
MgogICAgICAgIGVudW06IFsnMC40LjEtYWxwaGEuMicsICcwLjQuMS1hbHBoYS4xJywgJzAuNC4w\
JywgJzAuMy4wJywgJzAuMi4wJywgJzAuMS4wJ10KICAgICAgICB0eXBlOiBlbnVtCiAgICAgIC0g\
bmFtZTogc3RvcmFnZV9yb2xlCiAgICAgICAgdGl0bGU6IEJhY2tlbmQgU3RvcmFnZQogICAgICAg\
IGRlZmF1bHQ6IHN0b3JhZ2Utbm9uZQogICAgICAgIGVudW06IFsnc3RvcmFnZS1ub25lJ10KICAg\
ICAgICB0eXBlOiBlbnVtCiAgLSBuYW1lOiBnbHVzdGVyCiAgICBkZXNjcmlwdGlvbjogRGVwbG95\
bWVudCBwbGFuIHdpdGggR2x1c3RlciBzdG9yYWdlCiAgICBtZXRhZGF0YToKICAgICAgZGlzcGxh\
eU5hbWU6IEt1YmVWaXJ0IHdpdGggR2x1c3RlciBTdG9yYWdlCiAgICAgIGxvbmdEZXNjcmlwdGlv\
bjogVGhpcyBwbGFuIHByb3ZpZGVzIGt1YmV2aXJ0IHdpdGggR2x1c3RlciBzdG9yYWdlCiAgICBm\
cmVlOiBUcnVlCiAgICBwYXJhbWV0ZXJzOgogICAgICAtIHRpdGxlOiBPcGVuU2hpZnQgQWRtaW4g\
VXNlcgogICAgICAgIG5hbWU6IGFkbWluX3VzZXIKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAg\
ICByZXF1aXJlZDogdHJ1ZQogICAgICAtIHRpdGxlOiBPcGVuU2hpZnQgQWRtaW4gUGFzc3dvcmQK\
ICAgICAgICBuYW1lOiBhZG1pbl9wYXNzd29yZAogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAg\
IHJlcXVpcmVkOiB0cnVlCiAgICAgICAgZGlzcGxheV90eXBlOiBwYXNzd29yZAogICAgICAtIG5h\
bWU6IHZlcnNpb24KICAgICAgICB0aXRsZTogVmVyc2lvbgogICAgICAgIGRlZmF1bHQ6IDAuNC4x\
LWFscGhhLjIKICAgICAgICBlbnVtOiBbJzAuNC4xLWFscGhhLjInLCAnMC40LjEtYWxwaGEuMScs\
ICcwLjQuMCcsICcwLjMuMCcsICcwLjIuMCcsICcwLjEuMCddCiAgICAgICAgdHlwZTogZW51bQog\
ICAgICAtIG5hbWU6IHN0b3JhZ2Vfcm9sZQogICAgICAgIHRpdGxlOiBCYWNrZW5kIFN0b3JhZ2UK\
ICAgICAgICBkZWZhdWx0OiBzdG9yYWdlLWdsdXN0ZXJmcwogICAgICAgIGVudW06IFsnc3RvcmFn\
ZS1nbHVzdGVyZnMnXQogICAgICAgIHR5cGU6IGVudW0KICAgICAgLSB0aXRsZTogR2x1c3RlckZT\
IE5hbWVzcGFjZQogICAgICAgIG5hbWU6IG5hbWVzcGFjZQogICAgICAgIGRlc2NyaXB0aW9uOgog\
ICAgICAgICAgIlRoZSBuYW1lc3BhY2UgY29udGFpbmluZyB0aGUgR2x1c3RlckZTIGFuZCBIZWtl\
dGkgcmVzb3VyY2VzLiIKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICBkaXNwbGF5X2dyb3Vw\
OiBHbHVzdGVyRlMgU2V0dGluZ3MKICAgICAgLSB0aXRsZTogSGVrZXRpIFVSTCAoaWdub3JlZCBp\
ZiBIZWtldGkgUm91dGUgaXMgc3BlY2lmaWVkKQogICAgICAgIG5hbWU6IGhla2V0aV91cmwKICAg\
ICAgICBkZXNjcmlwdGlvbjoKICAgICAgICAgICJVUkwgdG8gcmVhY2ggdGhlIEhla2V0aSBzZXJ2\
aWNlLiBUaGlzIGlzIGlnbm9yZWQgaWYgSGVrZXRpIFJvdXRlIGlzCiAgICAgICAgICBzcGVjaWZp\
ZWQuIgogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIGRpc3BsYXlfZ3JvdXA6IEdsdXN0ZXJG\
UyBTZXR0aW5ncwogICAgICAtIHRpdGxlOiBIZWtldGkgUm91dGUKICAgICAgICBuYW1lOiBoZWtl\
dGlfcm91dGVfbmFtZQogICAgICAgIGRlc2NyaXB0aW9uOgogICAgICAgICAgIihPcGVuU2hpZnQg\
b25seSkgTmFtZSBvZiBhIFJvdXRlIHRvIHJlYWNoIHRoZSBIZWtldGkgc2VydmljZS4iCiAgICAg\
ICAgdHlwZTogc3RyaW5nCiAgICAgICAgZGlzcGxheV9ncm91cDogR2x1c3RlckZTIFNldHRpbmdz\
CiAgICAgIC0gdGl0bGU6IEhla2V0aSBTZWNyZXQKICAgICAgICBuYW1lOiBoZWtldGlfc2VjcmV0\
X25hbWUKICAgICAgICBkZXNjcmlwdGlvbjoKICAgICAgICAgICJOYW1lIG9mIGEgU2VjcmV0IGNv\
bnRhaW5pbmcgdGhlIEhla2V0aSBhZG1pbiBrZXkuIgogICAgICAgIHR5cGU6IHN0cmluZwogICAg\
ICAgIGRpc3BsYXlfZ3JvdXA6IEdsdXN0ZXJGUyBTZXR0aW5ncwogICAgICAtIHRpdGxlOiBVc2Ug\
ZXh0ZXJuYWwgcHJvdmlzaW9uZXI/CiAgICAgICAgbmFtZTogZXh0ZXJuYWxfcHJvdmlzaW9uZXIK\
ICAgICAgICBkZXNjcmlwdGlvbjoKICAgICAgICAgICJXaGV0aGVyIHRvIHVzZSB0aGUgZXh0ZXJu\
YWwgR2x1c3RlckZTIHByb3Zpc2lvbmVyLiBFbmFibGVzCiAgICAgICAgICBhZGRpdGlvbmFsIGZl\
YXR1cmVzLiIKICAgICAgICB0eXBlOiBib29sZWFuCiAgICAgICAgZGlzcGxheV9ncm91cDogR2x1\
c3RlckZTIFNldHRpbmdzCiAgLSBuYW1lOiBzdG9yYWdlLWRlbW8KICAgIGRlc2NyaXB0aW9uOiBE\
ZXBsb3ltZW50IHBsYW4gd2l0aCBlcGhlbWVyYWwgc3RvcmFnZQogICAgbWV0YWRhdGE6CiAgICAg\
IGRpc3BsYXlOYW1lOiBLdWJlVmlydCB3aXRoIGVwaGVtZXJhbCBTdG9yYWdlCiAgICAgIGxvbmdE\
ZXNjcmlwdGlvbjogVGhpcyBwbGFuIHByb3ZpZGVzIGt1YmV2aXJ0IHdpdGggZXBoZW1lcmFsIHN0\
b3JhZ2UKICAgIGZyZWU6IFRydWUKICAgIHBhcmFtZXRlcnM6CiAgICAgIC0gdGl0bGU6IE9wZW5T\
aGlmdCBBZG1pbiBVc2VyCiAgICAgICAgbmFtZTogYWRtaW5fdXNlcgogICAgICAgIHR5cGU6IHN0\
cmluZwogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgIC0gdGl0bGU6IE9wZW5TaGlmdCBBZG1p\
biBQYXNzd29yZAogICAgICAgIG5hbWU6IGFkbWluX3Bhc3N3b3JkCiAgICAgICAgdHlwZTogc3Ry\
aW5nCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgICBkaXNwbGF5X3R5cGU6IHBhc3N3b3Jk\
CiAgICAgIC0gbmFtZTogdmVyc2lvbgogICAgICAgIHRpdGxlOiBWZXJzaW9uCiAgICAgICAgZGVm\
YXVsdDogMC40LjEtYWxwaGEuMgogICAgICAgIGVudW06IFsnMC40LjEtYWxwaGEuMicsICcwLjQu\
MS1hbHBoYS4xJywgJzAuNC4wJywgJzAuMy4wJywgJzAuMi4wJywgJzAuMS4wJ10KICAgICAgICB0\
eXBlOiBlbnVtCiAgICAgIC0gbmFtZTogc3RvcmFnZV9yb2xlCiAgICAgICAgdGl0bGU6IEJhY2tl\
bmQgU3RvcmFnZQogICAgICAgIGRlZmF1bHQ6IHN0b3JhZ2UtZGVtbwogICAgICAgIGVudW06IFsn\
c3RvcmFnZS1kZW1vJ10KICAgICAgICB0eXBlOiBlbnVtCiAgLSBuYW1lOiBjaW5kZXIKICAgIGRl\
c2NyaXB0aW9uOiBEZXBsb3ltZW50IHBsYW4gZm9yIGt1YmV2aXJ0LWFwYiB3aXRoIENpbmRlciBi\
YWNrZW5kCiAgICBtZXRhZGF0YToKICAgICAgZGlzcGxheU5hbWU6IEt1YmVWaXJ0IHdpdGggQ2lu\
ZGVyIGJhY2tlbmQKICAgICAgbG9uZ0Rlc2NyaXB0aW9uOiBUaGlzIHBsYW4gcHJvdmlkZXMga3Vi\
ZXZpcnQgd2l0aCBDaW5kZXIgYmFja2VuZAogICAgZnJlZTogVHJ1ZQogICAgcGFyYW1ldGVyczoK\
ICAgICAgLSB0aXRsZTogT3BlblNoaWZ0IEFkbWluIFVzZXIKICAgICAgICBuYW1lOiBhZG1pbl91\
c2VyCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgLSB0\
aXRsZTogT3BlblNoaWZ0IEFkbWluIFBhc3N3b3JkCiAgICAgICAgbmFtZTogYWRtaW5fcGFzc3dv\
cmQKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAgIGRp\
c3BsYXlfdHlwZTogcGFzc3dvcmQKICAgICAgLSBuYW1lOiB2ZXJzaW9uCiAgICAgICAgdGl0bGU6\
IFZlcnNpb24KICAgICAgICBkZWZhdWx0OiAwLjQuMS1hbHBoYS4yCiAgICAgICAgZW51bTogWycw\
LjQuMS1hbHBoYS4yJywgJzAuNC4xLWFscGhhLjEnLCAnMC40LjAnLCAnMC4zLjAnLCAnMC4yLjAn\
LCAnMC4xLjAnXQogICAgICAgIHR5cGU6IGVudW0KICAgICAgLSBuYW1lOiBzdG9yYWdlX3JvbGUK\
ICAgICAgICB0aXRsZTogQmFja2VuZCBTdG9yYWdlCiAgICAgICAgZGVmYXVsdDogY2luZGVyCiAg\
ICAgICAgZW51bTogWydjaW5kZXInXQogICAgICAgIHR5cGU6IGVudW0K"



ENV APB_ACTION_PATH="kubevirt-ansible/playbooks/kubevirt.yml"
COPY requirements.yml /opt/ansible/requirements.yml
COPY inventory /etc/ansible/hosts

RUN ansible-galaxy install -r /opt/ansible/requirements.yml
RUN chmod -R g=u /opt/{ansible,apb} /etc/ansible/roles

USER apb
