FROM ansibleplaybookbundle/apb-base:galaxy

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IGt1YmV2aXJ0LWFwYgpkZXNjcmlwdGlvbjogS3ViZVZpcnQgaW5z\
dGFsbGVyCmJpbmRhYmxlOiBGYWxzZQphc3luYzogb3B0aW9uYWwKbWV0YWRhdGE6CiAgZGlzcGxh\
eU5hbWU6IEt1YmV2aXJ0CiAgaW1hZ2VVcmw6IGh0dHBzOi8vY2RuLnBicmQuY28vaW1hZ2VzL0g1\
R3V0ZDcucG5nCnBsYW5zOgogIC0gbmFtZTogZGVmYXVsdAogICAgZGVzY3JpcHRpb246IERlZmF1\
bHQgZGVwbG95bWVudCBwbGFuIGZvciBrdWJldmlydC1hcGIgd2l0aCBubyBzdG9yYWdlCiAgICBt\
ZXRhZGF0YToKICAgICAgZGlzcGxheU5hbWU6IERlZmF1bHQKICAgICAgbG9uZ0Rlc2NyaXB0aW9u\
OiBUaGlzIHBsYW4gcHJvdmlkZXMga3ViZXZpcnQgd2l0aCBubyBzdG9yYWdlCiAgICBmcmVlOiBU\
cnVlCiAgICBwYXJhbWV0ZXJzOgogICAgICAtIHRpdGxlOiBPcGVuU2hpZnQgQWRtaW4gVXNlcgog\
ICAgICAgIG5hbWU6IGFkbWluX3VzZXIKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICByZXF1\
aXJlZDogdHJ1ZQogICAgICAtIHRpdGxlOiBPcGVuU2hpZnQgQWRtaW4gUGFzc3dvcmQKICAgICAg\
ICBuYW1lOiBhZG1pbl9wYXNzd29yZAogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIHJlcXVp\
cmVkOiB0cnVlCiAgICAgICAgZGlzcGxheV90eXBlOiBwYXNzd29yZAogICAgICAtIG5hbWU6IHZl\
cnNpb24KICAgICAgICB0aXRsZTogVmVyc2lvbgogICAgICAgIGRlZmF1bHQ6IHYwLjQuMC1hbHBo\
YS4yCiAgICAgICAgZW51bTogWyd2MC40LjAtYWxwaGEuMicsICd2MC40LjAtYWxwaGEuMScsICd2\
MC40LjAtYWxwaGEuMCcsICd2MC4zLjAnLCAndjAuMi4wJywgJ3YwLjEuMCddCiAgICAgICAgdHlw\
ZTogZW51bQogICAgICAtIG5hbWU6IHN0b3JhZ2Vfcm9sZQogICAgICAgIHRpdGxlOiBCYWNrZW5k\
IFN0b3JhZ2UKICAgICAgICBkZWZhdWx0OiBzdG9yYWdlLW5vbmUKICAgICAgICBlbnVtOiBbJ3N0\
b3JhZ2Utbm9uZSddCiAgICAgICAgdHlwZTogZW51bQogIC0gbmFtZTogY25zCiAgICBkZXNjcmlw\
dGlvbjogRGVwbG95bWVudCBwbGFuIHdpdGggQ05TCiAgICBtZXRhZGF0YToKICAgICAgZGlzcGxh\
eU5hbWU6IEt1YmVWaXJ0IHdpdGggQ05TIFN0b3JhZ2UKICAgICAgbG9uZ0Rlc2NyaXB0aW9uOiBU\
aGlzIHBsYW4gcHJvdmlkZXMga3ViZXZpcnQgd2l0aCBDTlMgc3RvcmFnZQogICAgZnJlZTogVHJ1\
ZQogICAgcGFyYW1ldGVyczoKICAgICAgLSB0aXRsZTogT3BlblNoaWZ0IEFkbWluIFVzZXIKICAg\
ICAgICBuYW1lOiBhZG1pbl91c2VyCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgcmVxdWly\
ZWQ6IHRydWUKICAgICAgLSB0aXRsZTogT3BlblNoaWZ0IEFkbWluIFBhc3N3b3JkCiAgICAgICAg\
bmFtZTogYWRtaW5fcGFzc3dvcmQKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICByZXF1aXJl\
ZDogdHJ1ZQogICAgICAgIGRpc3BsYXlfdHlwZTogcGFzc3dvcmQKICAgICAgLSBuYW1lOiB2ZXJz\
aW9uCiAgICAgICAgdGl0bGU6IFZlcnNpb24KICAgICAgICBkZWZhdWx0OiB2MC40LjAtYWxwaGEu\
MgogICAgICAgIGVudW06IFsndjAuNC4wLWFscGhhLjInLCAndjAuNC4wLWFscGhhLjEnLCAndjAu\
NC4wLWFscGhhLjAnLCAndjAuMy4wJywgJ3YwLjIuMCcsICd2MC4xLjAnXQogICAgICAgIHR5cGU6\
IGVudW0KICAgICAgLSBuYW1lOiBzdG9yYWdlX3JvbGUKICAgICAgICB0aXRsZTogQmFja2VuZCBT\
dG9yYWdlCiAgICAgICAgZGVmYXVsdDogc3RvcmFnZS1jbnMKICAgICAgICBlbnVtOiBbJ3N0b3Jh\
Z2UtY25zJ10KICAgICAgICB0eXBlOiBlbnVtCiAgLSBuYW1lOiBzdG9yYWdlLWRlbW8KICAgIGRl\
c2NyaXB0aW9uOiBEZXBsb3ltZW50IHBsYW4gd2l0aCBlcGhlbWVyYWwgc3RvcmFnZQogICAgbWV0\
YWRhdGE6CiAgICAgIGRpc3BsYXlOYW1lOiBLdWJlVmlydCB3aXRoIGVwaGVtZXJhbCBTdG9yYWdl\
CiAgICAgIGxvbmdEZXNjcmlwdGlvbjogVGhpcyBwbGFuIHByb3ZpZGVzIGt1YmV2aXJ0IHdpdGgg\
ZXBoZW1lcmFsIHN0b3JhZ2UKICAgIGZyZWU6IFRydWUKICAgIHBhcmFtZXRlcnM6CiAgICAgIC0g\
dGl0bGU6IE9wZW5TaGlmdCBBZG1pbiBVc2VyCiAgICAgICAgbmFtZTogYWRtaW5fdXNlcgogICAg\
ICAgIHR5cGU6IHN0cmluZwogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgIC0gdGl0bGU6IE9w\
ZW5TaGlmdCBBZG1pbiBQYXNzd29yZAogICAgICAgIG5hbWU6IGFkbWluX3Bhc3N3b3JkCiAgICAg\
ICAgdHlwZTogc3RyaW5nCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgICBkaXNwbGF5X3R5\
cGU6IHBhc3N3b3JkCiAgICAgIC0gbmFtZTogdmVyc2lvbgogICAgICAgIHRpdGxlOiBWZXJzaW9u\
CiAgICAgICAgZGVmYXVsdDogdjAuNC4wLWFscGhhLjIKICAgICAgICBlbnVtOiBbJ3YwLjQuMC1h\
bHBoYS4yJywgJ3YwLjQuMC1hbHBoYS4xJywgJ3YwLjQuMC1hbHBoYS4wJywgJ3YwLjMuMCcsICd2\
MC4yLjAnLCAndjAuMS4wJ10KICAgICAgICB0eXBlOiBlbnVtCiAgICAgIC0gbmFtZTogc3RvcmFn\
ZV9yb2xlCiAgICAgICAgdGl0bGU6IEJhY2tlbmQgU3RvcmFnZQogICAgICAgIGRlZmF1bHQ6IHN0\
b3JhZ2UtZGVtbwogICAgICAgIGVudW06IFsnc3RvcmFnZS1kZW1vJ10KICAgICAgICB0eXBlOiBl\
bnVtCiAgLSBuYW1lOiBjaW5kZXIKICAgIGRlc2NyaXB0aW9uOiBEZXBsb3ltZW50IHBsYW4gZm9y\
IGt1YmV2aXJ0LWFwYiB3aXRoIENpbmRlciBiYWNrZW5kCiAgICBtZXRhZGF0YToKICAgICAgZGlz\
cGxheU5hbWU6IEt1YmVWaXJ0IHdpdGggQ2luZGVyIGJhY2tlbmQKICAgICAgbG9uZ0Rlc2NyaXB0\
aW9uOiBUaGlzIHBsYW4gcHJvdmlkZXMga3ViZXZpcnQgd2l0aCBDaW5kZXIgYmFja2VuZAogICAg\
ZnJlZTogVHJ1ZQogICAgcGFyYW1ldGVyczoKICAgICAgLSB0aXRsZTogT3BlblNoaWZ0IEFkbWlu\
IFVzZXIKICAgICAgICBuYW1lOiBhZG1pbl91c2VyCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAg\
ICAgcmVxdWlyZWQ6IHRydWUKICAgICAgLSB0aXRsZTogT3BlblNoaWZ0IEFkbWluIFBhc3N3b3Jk\
CiAgICAgICAgbmFtZTogYWRtaW5fcGFzc3dvcmQKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAg\
ICByZXF1aXJlZDogdHJ1ZQogICAgICAgIGRpc3BsYXlfdHlwZTogcGFzc3dvcmQKICAgICAgLSBu\
YW1lOiB2ZXJzaW9uCiAgICAgICAgdGl0bGU6IFZlcnNpb24KICAgICAgICBkZWZhdWx0OiB2MC40\
LjAtYWxwaGEuMgogICAgICAgIGVudW06IFsndjAuNC4wLWFscGhhLjInLCAndjAuNC4wLWFscGhh\
LjEnLCAndjAuNC4wLWFscGhhLjAnLCAndjAuMy4wJywgJ3YwLjIuMCcsICd2MC4xLjAnXQogICAg\
ICAgIHR5cGU6IGVudW0KICAgICAgLSBuYW1lOiBzdG9yYWdlX3JvbGUKICAgICAgICB0aXRsZTog\
QmFja2VuZCBTdG9yYWdlCiAgICAgICAgZGVmYXVsdDogY2luZGVyCiAgICAgICAgZW51bTogWydj\
aW5kZXInXQogICAgICAgIHR5cGU6IGVudW0K"


ENV APB_ACTION_PATH="kubevirt-ansible/playbooks/kubevirt.yml"
COPY requirements.yml /opt/ansible/requirements.yml

RUN ansible-galaxy install -r /opt/ansible/requirements.yml
RUN chmod -R g=u /opt/{ansible,apb} /etc/ansible/roles

USER apb
