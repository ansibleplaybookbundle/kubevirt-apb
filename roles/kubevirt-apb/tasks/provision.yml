---

- name: Login As Super User
  command: "oc login -u {{ admin_user }} -p {{ admin_password }}"

- name: Add Privileged Policy
  command: "oc adm policy add-scc-to-user privileged -z kubevirt-infra -n {{ namespace }}"

- name: Add Hostmount-anyuid Policy
  command: "oc adm policy add-scc-to-user hostmount-anyuid -z kubevirt-infra -n {{ namespace }}"

- name: Download Kubevirt Template
  get_url:
    url: "https://github.com/kubevirt/kubevirt/releases/download/{{ tag }}/kubevirt.yaml"
    dest: /tmp/kubevirt.yaml

- name: Create Kubevirt Resources
  command: oc create -f /tmp/kubevirt.yaml
  ignore_errors : true
